/* Project Description
Danny wants to use the data to answer a few simple questions about hia customers,especially about their visiting pg patterns;
- how much money they have spent
- which menu items are their favourites.

Having all these deeper connectionswith his customerswill help him deliver a better and more personalized experience for his loyal customers.

-- CREATING A DATABASE FOR THE TABLES
CREATE DATABASE FedanProject

-- CREATING A SCHEMA FOR THE TABLES
CREATE SCHEMA Danny

-- CREATING TABLES
CREATE TABLE Danny.sales(customer_id Varchar(1),order_date(DATE), product_id(INT).

##showing the total amount each customer spent at the restaurant
SELECT sales.customer_id, SUM(menu.price) AS total_amount_spent
FROM Danny.sales AS sales
JOIN Danny.menu AS menu
ON sales.product_id = menu.product_id
GROUP BY sales.customer_id;


##showing how many days each customer visited the restaurant 
SELECT sales.customer_id, COUNT(DISTINCT(order_date)) AS total_visits
FROM Danny.sales
GROUP BY customer_id;

##showing the first item from the menu purchased by each customer
WITH purchases_first_cte AS (                  
    SELECT customer_id, order_date, product_name,
    DENSE_RANK() OVER(PARTITION BY sales.customer_id
                      ORDER BY sales.order_date) AS Rank
    FROM Danny.sales AS sales
    JOIN Danny.menu AS menu
    ON sales.product_id = menu.product_id
    )
    
SELECT customer_id, product_name
FROM purchases_first_cte 
WHERE RANK = 1
GROUP BY customer_id, product_name ;
    

##Showing the most purchased item on the menu and how many times it was purchased by all customers










